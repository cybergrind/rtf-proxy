from binascii import hexlify
import struct


def format_packet(packet):
    _type = struct.unpack('!B', packet[:1])
    return f'Type: {_type} Payload: {packet}'


def print_unpack(state, format, packet):
    out = struct.unpack(format, packet)
    print('\t'.join(map(lambda x: str(x).rjust(8), out)).strip())


def save_packet(state, packet):
    state.counter += 1
    if state.is_test:
        return
    _type = struct.unpack('!B', packet[:1])[0]
    with open(f'packets/sample_{state.counter:04d}_{_type}.rotf{_type}', 'wb') as f:
        f.write(packet)


def encode_packet(packet):
    return struct.pack('!I', len(packet)) + packet


def payload_to_packet(payload):
    return struct.pack('!I', len(payload) + 4) + payload


with open('sample_85.79e.rotf85', 'wb') as f:
    f.write(b'U\x00\x00\x01h\x00\x00\x00d\x00P\x00\x04iCD\x01U\xf8D\\\x96V\x00\x00\x00\x04jeC\xd5\xcf\x89DZ\xf5\xf7\x00\x00\x00\x04^pC\xf2\x9awD\x9f\xec\xdb\x00\x01\x01\x00\x00\x02Q\x00\x04i\x98D|\x0fkDtvf\x00\x00\x00\x04ibD\xce\xff\xa0D\xbdC\x18\x00\x00\x00\x04ieDi\xe4\x9eD\x83\xb9\x0b\x00\x01\x01\x00\x00\x03\x19\x00\x04lKD4P\xc5D\x17\xf7\xf0\x00\x01\x04\x00\x00\x00~\x00\x04^\xbfDx\x865Dx\x0eO\x00\x00\x00\x04k\xf7Dt\x1a\xf0Dv\xdeu\x00\x01\x01\x00\x00\x07\xe1\x00\x04Z\x8fC\xd9\x99\xfaD[\xc5\xe0\x00\x02\x01\x00\x00\x02\xb2\x04\x00\x00\x00F\x00\x04M\xa3C\xe0\x03\x14D]O\x84\x00\x01\x04\x00\x00\x00\xcd\x00\x04O\xd3D|\x05\x91D}\x10\x1a\x00\x00\x00\x04cmC\xf6C\x83D[\xe7\xd7\x00\x00\x00\x04e\xa9D\x04\x1a\x99Dk|\x82\x00\x00\x00\x04g\xd8C\xf0FpD\\\xa5<\x00\x01\x04\x00\x00\x01\x00\x00\x04c~D\x82(\x9fD\x86M?\x00\x01\x04\x00\x00\x00\xec\x00\x04c\x80C\xe0\x95\x93D@\xd0\xe3\x00\x00\x00\x04g\xdfD}\x92;D{u\xd4\x00\x03\x04\x00\x00\x00\xb6\x1d\x00\x08@\x00`\x00\x00\x00\x00\x00\x04a[Dw\xbcGDvvm\x00\x00\x00\x04_/Dx\x1bjDa\xa5\xa3\x00\x01\x04\x00\x00\x00\xe9\x00\x04g\xf0Dr\xd1\xb1D~\x94\xf2\x00\x01\x04\x00\x00\x00\xe4\x00\x04K\xa8D\x01\xbd\x14Dg:\x01\x00\x01\x01\x00\x00\x02\xbe\x00\x04c\xa8Dz\x9bHDz\xaf"\x00\x00\x00\x04e\xd7C\xf3E5De\xda\xa0\x00\x00\x00\x04e\xdaD\x8c\n\xf2D\\,\xf8\x00\x00\x00\x04]*D\x0e=\xd3Dg\x9bh\x00\x01\x04\x00\x00\x00\xda\x00\x04e\xedD\x9e\xeb\xe0C\xf12\xdf\x00\x00\x00\x04c\xc1DvhHD^w\xb1\x00\x01\x01\x00\x00\x02+\x00\x04a\xa3Du\xe9\xcdD`\xc4\xe7\x00\x00\x00\x04f\x05Ds\x88\x04D\x85Y\xa6\x00\x00\x00\x04c\xdbD}rCD~\xdd\xbd\x00\x00\x00\x04_\x88Dv\xa1\x8eDs$7\x00\x01\x04\x00\x00\x00\xc3\x00\x04f\x18D{D\xc7Dv\x04N\x00\x00\x00\x04_\xa9Dw\n?Dx\xa8\xec\x00\x00\x00\x04G\xbfD+\x02tDi4\x11\x00\x02\x01\x00\x00\t\xb5\x04\x00\x00\x00d\x00\x04_\xb7D\x9d\x14\xe2D\x08\x11$\x00\x00\x00\x04fFC\xe8\xfe\x10D`}\xa5\x00\x00\x00\x04kED\x91\'\x84C\x03\xd6M\x00\x00\x00\x04N\\Dv\xf4\xd3D|wM\x00\x00\x00\x04d+D\t\xc1\x04Df\xe0\xc6\x00\x00\x00\x04h\x89D\x81\xeb\xfcD\x85\xf7\xc9\x00\x00\x00\x04d6C\xf6~\x8cDd\xf1\xfd\x00\x00\x00\x04h\x92C\xcaX/D_[G\x00\x00\x00\x04h\x94Dr\x88\xd2D|\xb9\xa9\x00\x00\x00\x04h\x96C\xde\x83+DZ\xeb\x86\x00\x01\x04\x00\x00\x00n\x00\x04d?C\xf1\xe1SDXe\x8a\x00\x01\x04\x00\x00\x015\x00\x04h\x9dD\x7fN\xe3D\x7f\xee\xf3\x00\x02\x01\x00\x00\x03\x99\x04\x00\x00\x01?\x00\x04P\xc5Dv\xee%D|\xbc\xb4\x00\x00\x00\x04Y\x7fDe*\xe2D\x81\x02~\x00\x02\x01\x00\x00\x02\xc9\x04\x00\x00\x01\xf8\x00\x04S\x07D*\xbd\xcaDk6\n\x00\x01\x04\x00\x00\x01\t\x00\x04h\xccDvY_DZ\xff\xde\x00\x01\x04\x00\x00\x00\xbe\x00\x04h\xd1C\xce\x14\xbaD]\xe2x\x00\x01\x01\x00\x00\x08\xda\x00\x04l\x13D6\xe6:D\x1b\xff\\\x00\x01\x04\x00\x00\x00E\x00\x04h\xd6C\xd7\xff\xbfDY\xb3\xa6\x00\x01\x01\x00\x00\x02\xda\x00\x04h\xdaC\xd2F<D[\\|\x00\x00\x00\x04j\x88D]\xc9\xd8Dv$\x0b\x00\x00\x00\x04h\xe8D_\x9fWD\x81\x94?\x00\x02\x01\x00\x00\x02\xcc\x04\x00\x00\x01S\x00\x04j\x01D\x08\x7f\\D^\x8a,\x00\x00\x00\x04bnDn\x10/Dg\xcc\xf0\x00\x00\x00\x04Y\xbcC\xffM\xacD_\xaf\xa9\x00\x01\x04\x00\x00\x01<\x00\x04`WD\x01\x16YDYr?\x00\x00\x00\x04d\xbdC\xe1~\xb8DXIq\x00\x00\x00\x04`hC\xef~\xb8D\\\xb3"\x00\x00\x00\x04i!D\x9d\x1c\xeaD\x08]8\x00\x00\x00\x04^PC\xfcduD[\xa3\x11\x00\x00\x00\x04i\xbfD\x82\x03WD\x86R\x9c\x00\x01\x01\x00\x00\x0b\x97\x00\x04i\xbeD\x86.\x04D{N!\x00\x00\x00\x04i\xb5C\xfa\x86\xb6D^[(\x00\x00\x00\x04i\xadD\xa2twC\xdas\x80\x00\x01\x01\x00\x00\x02B\x00\x04i\xb6D/\xef\x85D\x89\xecn\x00\x00\x00\x04i\xa8Du\x9d\xadDa\x18\x1b\x00\x00\x00\x04i\x89C\xe0\x8a!D[\x0fP\x00\x00\x00\x04i\x93D\xd1KvD\xbb\x7f\xad\x00\x01\x04\x00\x00\x00\x92\x00\x04j\xaaDp`\x96Dn"\xd4\x00\x00\x00\x04kFC\xb3x\xfdD\x1c\x81\x7f\x00\x00\x00\x04W\x9eDj*\xfbD\x82\xefY\x00\x01\x01\x00\x00\x05\xa8\x00\x04k\x88C\xf9h8D\\\xa6\xf1\x00\x01\x04\x00\x00\x00\xa4\x00\x04k\x93C\xfb\xa4\x9cD_\xeb\xe8\x00\x00\x00\x04lgC\x9dD\xd6D\x18\xed\x0b\x00\x01\x04\x00\x00\x00Z\x00\x04kuC\xfb~\xb8DZ\xd9F\x00\x01\x04\x00\x00\x020')

